<!DOCTYPE html>
<html lang="en">
<head>
    <title>WarsawJS Meetup: Debugging memory leaks</title>

    <meta charset="utf-8"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <meta name="viewport" content="width=device-width"/>
    <link href="images/icons/warsawjs-logo-transparent-32x32.png" rel="icon" type="image/png" sizes="32x32"/>

    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:400,900&amp;subset=latin-ext" rel="stylesheet"/>

    <!-- Shower Theme -->
    <link rel="stylesheet" href="vendors/shower-ribbon/styles/screen-16x9.css"/>
    <link rel="stylesheet" href="vendors/shower-warsawjs/styles/main.css"/>

    <!-- Prism.js -->
    <link rel="stylesheet" href="vendors/prism/prism.css"/>
    <link rel="stylesheet" href="vendors/prism/custom-prism.css"/>

    <!-- my additions -->
    <link rel="stylesheet" href="styles/my-theme.css">
</head>
<body class="shower list">
    <header class="caption">
        <h1>WarsawJS Meetup: Debugging memory leaks</h1>
        <p>We talk about JavaScript. Each month in Warsaw, Poland.</p>
    </header>

    <section class="slide front-page">
        <div class="logo">
            <!-- Logo WarsawJS -->
            <img src="vendors/shower-warsawjs/images/logo.svg" width="350" alt=""/>
        </div>
        <div class="details">
            <!-- 1. Avatar -->
            <img src="images/mg.png" alt="Speaker" width="200"/>

            <!-- 2. Speaker -->
            <h2>Maciej Gołaszewski</h2>

            <!-- 3. Presentation title -->
            <h2><strong>"WarsawJS Meetup: Debugging memory leaks" [EN]</strong></h2>

            <!-- 4. Presentation date -->
            <h2>2019-12-12</h2>

            <!-- 5. Contact the speaker -->
            <h2><a href="http://twitter.com/jodator">@jodator</a></h2>
        </div>
    </section>

    <section class="slide compact">
        <h2>Memory management in JavaScript</h2>

        <div class="double">
            <p>JavaScript automatically allocates memory when objects are created.</p>
            <p><strong>Garbage collection</strong> - is a process of automatically freeing memory when those objects are no longer used.</p>
            <p class="next">JavaScript Memory life-cycle:</p>
            <ol>
                <li class="next">allocate</li>
                <li class="next">use</li>
                <li class="next">release</li>
            </ol>
        </div>
    </section>

    <section class="slide compact">
        <h2>Step 1: Allocate</h2>

        <ul>
            <li>Initial declaration of primitives (like <code>Number</code> or <code>String</code>)/</li>
            <li>For <code>Object</code> & <code>Array</code> - it also allocates memory for contained values.</li>
            <li>Function declaration (<code>() => {}</code>) allocates a callable object (<code>Function</code>)</li>
            <li>Object creation <code>new Foo()</code>, <code>new Date()</code>, etc.</li>
            <li>Element creation - <code>document.createElement( 'div' ).</code></li>
            <li>Array and string manuipulation methods: <code>array.concat( otherArray )</code>, <code>'JavaScript'.substr( 0, 4 )</code>,
                etc.
            </li>
        </ul>

    </section>

    <section class="slide compact">
        <h2>Step 2: Use</h2>

        <figure  class="place bottom">
            <img src="images/gifs/source.gif" width="450">
            <figcaption class="white">Source <a href="https://giphy.com/gifs/cat-pizza-lazers-zdzG4ByVrd1V6?utm_source=media-link&utm_medium=landing&utm_campaign=Media%20Links&utm_term=">giphy</a>.</figcaption>
        </figure>
    </section>

    <section class="slide compact">
        <h2>Step 3: Release</h2>

        <p>How do Garbage Collector decides if some memory is not needed anymore?</p>

        Reference - one object reference another if the former has access to the latter (implicitly or explicitly).

        - implicitly - ie to its prototype
        - to its properties values

        <p>This means that object in memory management is considered with it function or lexical scope (so what's visible in current
            position
            in execution stack).</p>
        <!-- TODO -->
        ## How JavaScript detects memory to free?

        Meet the "Mark-and-sweep algorithm"

        IMG

        The "object no longer needed" is an "unreachable object".

        We assume well-known set of objects "roots". In JavaScript it is the *global* object (AKA window).

        The M&S periodically start from a root and find all objects referenced from these roots, then objects referenced by these and so on.

        When going from root to all objects the Garbage Collector will find all non-reachable.

        All modern browsers comes with mark-and-sweep garbage collector (with some improvements - but the general idea of an object that is
        no longer need stays the same.

        function foo() {
        const x = "foo";
        return "baz";
        }

        foo();
    </section>

    <section class="slide compact">
        <h2>Releasing the memory</h2>
        <blockquote>
            <p>As of 2019 We cannot release memory manually (call garbage collector).</p>
        </blockquote>

        <p>That's true, but:</p>
        <ul>
            <li>In Node.js you can increase heap memory <code>node --max-old-space-size=9001 index.js</code>.</li>
            <li>For Chrome there's <code>--expose gc</code> flag for exposing <code>window.gc()</code> method.</li>
        </ul>
    </section>

    <section class="slide compact">
        <h2>Common causes of memory leaks</h2>

        <ul>
            <li>globals</li>
            <li>globals!</li>
            <li>shared lexical scope</li>
            <li>forgotten callbacks</li>
            <li>forgotten DOM nodes</li>
        </ul>
    </section>

    <section class="slide compact">
        <h2>Tools - how to find memory leaks</h2>

        <ul>
            <li>Google Chrome dev tools - memory tab</li>
            <li>Firefox dev tool - memory tab</li>
            <li><code>window.performance.memory</code></li>
        </ul>
    </section>

    <section class="slide prism">
        <h2>Memory leaks: Accidental global</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                document.getElementById( 'ml-global' )
                    .addEventListener( 'click', () => {
                        // window.bo = new BigObject();
                        // bo = new BigObject();
                        this.bo = new BigObject(); // this === window
                    } );
            </code>
        </pre>
        <a href="demo.html" target="_blank" rel="noopener noreferrer">Demo</a>
    </section>

    <section class="slide prism">
        <h2>Memory leaks: Intermediate values</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                const config = {
                    bo: new BigObject(), // used somewhere else
                    foo: 'bar',
                    interval: 1000
                };

                logSomething( config );

                function logSomething( config ) {
                    // Also don't forget your intervals!
                    setInterval( () => {
                        console.log( config.foo );
                    }, config.interval );
                }
            </code>
        </pre>
        <a href="demo.html" target="_blank" rel="noopener noreferrer">Demo</a>
    </section>

    <section class="slide prism">
        <h2>Memory leaks: Shared lexical scope</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                let theThing = null;

                function replaceThing() {
                    const originalThing = theThing;

                    function unused() {
                        if ( originalThing ) {
                            console.log( 'Hello there!' );
                        }
                    }

                    theThing = {
                        bo: new BigObject(),
                        someMethod: function() {
                            console.log( 'Some method...' );
                        }
                    };
                }
            </code>
        </pre>
        <a href="demo.html" target="_blank" rel="noopener noreferrer">Demo</a>
    </section>

    <section class="slide prism">
        <h2>Memory leaks: Forgotten DOM nodes</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                const myStuff = {};

                document.getElementById( 'ml-forgotten-dom' ).addEventListener( 'click', () => {
                    const button = document.createElement( 'input' );
                    button.type = 'button';
                    button._bo = new BigObject();

                    myStuff.button = button;

                    document.body.appendChild( button );

                    button.addEventListener( 'click', removeButton );

                    function removeButton() {
                        document.body.removeChild( document.getElementById( 'click-me' ) );
                        button.removeEventListener( 'click', removeButton );
                    }
                } );
            </code>
        </pre>
        <a href="demo.html" target="_blank" rel="noopener noreferrer">Demo</a>

        <p class="reference">Ref: <a href="https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156"
                                     target="_blank" rel="noopener noreferrer">An interesting kind of JavaScript memory leak</a>.</p>
    </section>

    <section class="slide prism">
        <h2>Memory leaks: Forgotten stuff...</h2>
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                const bo = new BigObject();
                const node = document.getElementById( 'a-div' );

                function detachNode() {
                    node.remove();
                }

                setInterval( () => {
                    console.log( bo[ 3 ] );
                }, 500 );

                console.log( bo );
            </code>
        </pre>
        <a href="demo.html" target="_blank" rel="noopener noreferrer">Demo</a>
    </section>

    <section class="slide compact">
        <h2>ProTips™</h2>

        <ul>
            <li>be careful with anonymous functions for callbacks (if scope is shared)</li>
            <li>pass only what you need - big objects - retentions</li>
            <li>de-register callbacks</li>
            <li>consider using `WeakMap` instead of `Map`</li>
            <li>GC must pause execution to collect garbage - so if you experience lags - it might be this.</li>
            <li>if in doubt - measure</li>
            <li>when testing - disable all addons</li>
        </ul>
    </section>

    <section class="slide prism">
        <h2>Disabling addons - Chrome</h2>

        <pre>
            <code class="language-javascript line-numbers">
            google-chrome \
                --enable-precise-memory-info \
                --disable-extensions \
                --disable-plugins \
                --incognito
                http://example.com</code>
        </pre>
    </section>

    <section class="slide prism">
        <h2>Disabling addons - Firefox</h2>

        <pre>
            <code class="language-javascript line-numbers">
            firefox \
                -P "empty" \
                --new-instance \
                --safe-mode \
                http://localhost:8125
            </code>
        </pre>
    </section>

    <section class="slide compact">
        <h2>List Navigation</h2>
        <ol>
            <li>Ennui keffiyeh thundercats</li>
            <li class="next">Jean shorts biodiesel</li>
            <li class="next">Terry richardson, swag blog</li>
            <li class="next">Locavore umami vegan helvetica</li>
            <li class="next">Fingerstache kale chips</li>
        </ol>
        <p class="next">Before they sold out master</p>
    </section>

    <section class="slide compact">
        <h2>Slide Header</h2>

        <p>Echo Park 8-bit sustainable umami deep v Kickstarter. DIY cliche typewriter brunch, Odd Future sriracha pickled aesthetic. Farm-to-table bespoke fingerstache, kale chips umami brunch letterpress.</p>
        <p>Whatever authentic disrupt, you probably haven't heard of them direct trade mlkshk Etsy. Gluten-free roof party plaid four loko quinoa.</p>
        <p class="note">Echo Park 8-bit sustainable umami deep v Kickstarter.</p>
    </section>

    <section class="slide compact">
        <h2>Inline Elements</h2>

        <p>Retro meh brunch <a href="">aesthetic</a> Cosby sweater Shoreditch. Banksy Tumblr
            <strong>sriracha</strong>, flexitarian pug chia master cleanse vinyl
            <em>wayfarers</em> fanny pack bespoke Helvetica <b>roof</b> party. Messenger bag retro cred
            <i>Portland</i> next level. Yr stumptown Schlitz Carles deep v small batch. Hella sustainable messenger bag,
            <mark>leggings</mark>
            skateboard literally<sup>1</sup> bicycle rights H<sub>2</sub>0 mumblecore banh mi DIY VHS. Semiotics four loko street art asymmetrical. Asymmetrical
            <code>&lt;paleo&gt;</code> you probably haven’t heard of.
        </p>

        <footer class="footer">
            <p>Retro meh brunch <a href="">aesthetic</a> Cosby sweater Shoreditch. Banksy Tumblr
                <strong>sriracha</strong>, flexitarian pug chia master cleanse vinyl
                <em>wayfarers</em> fanny pack bespoke Helvetica <b>roof</b> party. Messenger bag retro cred
                <i>Portland</i> next level. Yr stumptown Schlitz Carles deep v small batch. Hella sustainable messenger bag,
                <mark>leggings</mark>
                skateboard literally<sup>1</sup> bicycle rights H<sub>2</sub>0 mumblecore banh mi DIY VHS. Semiotics four loko street art asymmetrical. Asymmetrical
                <code>&lt;paleo&gt;</code> you probably haven’t heard of.
            </p>
        </footer>
    </section>

    <section class="slide compact">
        <h2>Columns</h2>
        <p class="double">Echo Park 8-bit sustainable umami deep v Kickstarter. DIY cliche typewriter brunch, Odd Future sriracha pickled aesthetic. Farm-to-table bespoke fingerstache, kale chips umami brunch American Apparel letterpress. Whatever authentic disrupt, you probably haven't heard of them direct trade mlkshk Etsy. Gluten-free roof party plaid American Apparel four loko quinoa. Echo Park 8-bit sustainable.</p>
    </section>

    <section class="slide">
        <h2>Quotes</h2>
        <blockquote>
            <p>Flannel bicycle rights locavore selfies skateboard. Authentic fanny pack paleo four loko bespoke. Artisan tattooed chia XOXO ennui, lomo disrupt 8-bit art party Tumblr scenester.</p>
        </blockquote>
        <figure>
            <blockquote>
                <p>Post-ironic fashion axe flexitarian, Tonx narwhal messenger bag Tumblr. Portland gentrify deep v kale chips literally.</p>
            </blockquote>
            <figcaption>Yours Truly</figcaption>
        </figure>
    </section>

    <section class="slide compact">
        <h2>Nested Lists</h2>
        <ol>
            <li>Literally viral vegan, ugh drinking vinegar photo booth</li>
            <li>Wes Anderson chillwave Marfa pour-over Etsy banh mi</li>
            <li>Ethnic polaroid lo-fi iPhone ennui
                <ul>
                    <li>Yr wayfarers before they sold out Kickstarter asymmetrical</li>
                    <li>Irony flexitarian readymade quinoa, kogi bespoke meggings narwhal</li>
                    <li>Skateboard Etsy twee artisan Echo Park</li>
                </ul>
            </li>
            <li>Tonx kitsch fingerstache readymade, retro single-origin coffee</li>
        </ol>
    </section>

    <section class="slide compact">
        <h2>Simple Table</h2>
        <table>
            <tr>
                <th scope="col">Gentrify</th>
                <th>Twee</th>
                <th>Artisan</th>
                <th>Banksy</th>
            </tr>
            <tr>
                <th scope="row">Messenger</th>
                <td>Mixtape</td>
                <td>Small batch</td>
                <td>Bicycle rights</td>
            </tr>
            <tr>
                <th scope="row">Meggings</th>
                <td>Freegan</td>
                <td>Retro biodiesel</td>
                <td>Slow-carb</td>
            </tr>
            <tr>
                <th scope="row">Vegan</th>
                <td>Occupy</td>
                <td>Normcore</td>
                <td>Put a bird on it</td>
            </tr>
            <tr>
                <th scope="row">Next level</th>
                <td>Selfies</td>
                <td>Sustainable</td>
                <td>Organic</td>
            </tr>
            <tr>
                <th scope="row">Umami</th>
                <td>Asymmetrical</td>
                <td>Keytar</td>
                <td>Craft beer</td>
            </tr>
            <tr>
                <th scope="row">Biodiesel</th>
                <td>Haven’t heard</td>
                <td>Skateboard</td>
                <td>Farm-to-table</td>
            </tr>
        </table>
    </section>

    <section class="slide compact">
        <h2>Striped Table</h2>
        <table class="striped">
            <tr>
                <th scope="col">Gentrify</th>
                <th>Twee</th>
                <th>Artisan</th>
                <th>Banksy</th>
            </tr>
            <tr>
                <th scope="row">Messenger</th>
                <td>Mixtape</td>
                <td>Small batch</td>
                <td>Bicycle rights</td>
            </tr>
            <tr>
                <th scope="row">Meggings</th>
                <td>Freegan</td>
                <td>Retro biodiesel</td>
                <td>Slow-carb</td>
            </tr>
            <tr>
                <th scope="row">Vegan</th>
                <td>Occupy</td>
                <td>Normcore</td>
                <td>Put a bird on it</td>
            </tr>
            <tr>
                <th scope="row">Next level</th>
                <td>Selfies</td>
                <td>Sustainable</td>
                <td>Organic</td>
            </tr>
            <tr>
                <th scope="row">Umami</th>
                <td>Asymmetrical</td>
                <td>Keytar</td>
                <td>Craft beer</td>
            </tr>
            <tr>
                <th scope="row">Biodiesel</th>
                <td>Haven’t heard</td>
                <td>Skateboard</td>
                <td>Farm-to-table</td>
            </tr>
        </table>
    </section>

    <section class="slide prism">
        <h2>Listing Slide</h2>

        <pre style="font-size: 45px;" class="language-javascript line-numbers">
            <code>
                function wrap(value) {
                    return function () {
                        return value;
                    }
                }

                function bind(monad, f) {
                    return f(monad());
                }
            </code>
        </pre>
    </section>

    <section class="slide prism">
        <pre style="font-size: 30px;" class="language-javascript line-numbers">
            <code>
                var monad = wrap('cookie');
                bind(monad, (value) => {
                    console.info(value);
                    return wrap(value);
                });
                monad = bind(monad, (value) => {
                    return wrap({ type: value });
                });
                bind(monad, (value) => {
                    console.log(value);
                    return wrap(value);
                });
            </code>
        </pre>
    </section>

    <section class="slide">
        <h2 class="shout"><a href="">Linked</a> Shout</h2>
    </section>

    <section class="slide">
        <h2 class="shout grow">Effect: Growing Shout</h2>
    </section>

    <section class="slide">
        <h2 class="shout shrink">Effect: Shrinking Shout</h2>
    </section>

    <section class="slide">
        <figure>
            <img class="cover" src="vendors/shower-ribbon/pictures/exact.png" alt="">
            <figcaption class="white">Copyright © 2016 <a href="">Yours Truly</a>, Famous Inc.</figcaption>
        </figure>
    </section>

    <section class="slide">
        <img class="cover" src="vendors/shower-ribbon/pictures/tall.png" alt="">
    </section>

    <section class="slide">
        <img class="cover" src="vendors/shower-ribbon/pictures/wide.png" alt="">
    </section>

    <section class="slide white">
        <img class="place top left" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place top" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place top right" src="vendors/shower-ribbon/pictures/square.png" alt="">

        <img class="place left" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place right" src="vendors/shower-ribbon/pictures/square.png" alt="">

        <img class="place bottom left" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place bottom" src="vendors/shower-ribbon/pictures/square.png" alt="">
        <img class="place bottom right" src="vendors/shower-ribbon/pictures/square.png" alt="">
    </section>

    <section class="slide" data-timing="00:03">
        <h3 class="shout">Automatic switch slide after <strong>3 secs</strong> ...</h3>
    </section>

    <section class="slide">
        <img class="cover" src="images/gifs/example-gif.gif" width="480" height="360" alt=""/>
    </section>

    <section class="slide">
        <h3 class="shout">Thanks!</h3>
    </section>

    <div class="progress"></div>

    <footer class="badge">
        <a href="https://github.com/jodator/warsawjs-debugging-memory-leaks">Fork me on GitHub</a>
    </footer>

    <footer class="badge badge-top-left">
        <a href="#" class="fullscreen">Fullscreen</a>
    </footer>

    <script src="vendors/gamepad/gamepad.js"></script>
    <script src="vendors/shower/shower.min.js"></script>
    <script src="vendors/shower-gamepad/shower.gamepad.js"></script>
    <script src="vendors/shower-warsawjs/scripts/fullscreen.js"></script>

    <!-- Prism.js -->
    <script src="vendors/prism/prism.js"></script>
    <script src="vendors/prism/custom-prism.js"></script>
</body>
</html>
